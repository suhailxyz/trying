<!-- Windows 98 Loading Bar Component - Styles are in styles.css -->
<!-- Usage: Copy this HTML block (make sure styles.css is linked) -->
<div class="win98-loading">
  <p class="win98-loading-text">Loading...</p>
  <div class="win98-loading-bar-container">
    <div class="win98-loading-bar-track">
      <div class="win98-loading-bar-segments">
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
        <div class="win98-loading-bar-segment"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  function initLoadingBar(container) {
    const segments = container.querySelectorAll('.win98-loading-bar-segment');
    let currentIndex = 0;
    let isFlashing = false;
    
    function loadNextSegment() {
      // Check if we're at the second-to-last block - get stuck here
      if (currentIndex === segments.length - 2) {
        const segment = segments[currentIndex];
        if (segment) {
          segment.classList.add('visible', 'flashing');
          // Keep flashing indefinitely - never progress
          return;
        }
      }
      
      if (currentIndex >= segments.length) {
        // Reset and loop
        segments.forEach(seg => {
          seg.classList.remove('visible', 'flashing');
        });
        currentIndex = 0;
      }
      
      const segment = segments[currentIndex];
      if (!segment) return;
      
      // Show the segment
      segment.classList.add('visible', 'flashing');
      isFlashing = true;
      
      // Random number of flashes between 2 and 5
      const flashCount = Math.floor(Math.random() * 4) + 2; // 2-5 flashes
      const flashDuration = 800; // Duration of one flash cycle
      const totalFlashTime = flashCount * flashDuration;
      
      // Flash for random amount of time, then make it solid
      setTimeout(() => {
        segment.classList.remove('flashing');
        isFlashing = false;
        currentIndex++;
        
        // Move to next segment
        setTimeout(loadNextSegment, 100);
      }, totalFlashTime);
    }
    
    // Start the animation
    loadNextSegment();
  }
  
  // Initialize all loading bars on the page
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.win98-loading').forEach(initLoadingBar);
  });
  
  // Also run immediately in case DOM is already loaded
  document.querySelectorAll('.win98-loading').forEach(initLoadingBar);
})();
</script>
